<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Applying gates to your fcs file paths | Mass cytof/flow pipeline in R</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Applying gates to your fcs file paths | Mass cytof/flow pipeline in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Applying gates to your fcs file paths | Mass cytof/flow pipeline in R" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Kei Onn,Lai" />


<meta name="date" content="2025-04-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="importing-the-gating-template.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="batchgating-with-.wsp-template.html"><a href="batchgating-with-.wsp-template.html"><i class="fa fa-check"></i><b>1</b> Batchgating with .wsp template</a>
<ul>
<li class="chapter" data-level="1.1" data-path="batchgating-with-.wsp-template.html"><a href="batchgating-with-.wsp-template.html#getting-your-filepaths"><i class="fa fa-check"></i><b>1.1</b> getting your filepaths</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing-the-gating-template.html"><a href="importing-the-gating-template.html"><i class="fa fa-check"></i><b>2</b> Importing the gating template</a>
<ul>
<li class="chapter" data-level="2.1" data-path="importing-the-gating-template.html"><a href="importing-the-gating-template.html#visualisation"><i class="fa fa-check"></i><b>2.1</b> Visualisation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="applying-gates-to-your-fcs-file-paths.html"><a href="applying-gates-to-your-fcs-file-paths.html"><i class="fa fa-check"></i><b>3</b> Applying gates to your fcs file paths</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mass cytof/flow pipeline in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="applying-gates-to-your-fcs-file-paths" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Applying gates to your fcs file paths<a href="applying-gates-to-your-fcs-file-paths.html#applying-gates-to-your-fcs-file-paths" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Here we will be applying the gate you created
using <code>flowjo_to_gatingset()</code> to the fcs file paths of your interest.
Again I am selecting <code>gs[[1]]</code> meaning the first sample of my gating set</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="applying-gates-to-your-fcs-file-paths.html#cb4-1" tabindex="-1"></a>gating_applied<span class="ot">&lt;-</span>flowWorkspace<span class="sc">::</span><span class="fu">gh_apply_to_new_fcs</span>(gs[[<span class="dv">1</span>]], all_files,<span class="at">emptyValue=</span>F)</span></code></pre></div>
<p>Here we are checking the output of a single fcs file after applying the gate</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="applying-gates-to-your-fcs-file-paths.html#cb5-1" tabindex="-1"></a><span class="fu">gs_pop_get_count_with_meta</span>(gating_applied[[<span class="dv">1</span>]],<span class="st">&#39;freq&#39;</span>)</span>
<span id="cb5-2"><a href="applying-gates-to-your-fcs-file-paths.html#cb5-2" tabindex="-1"></a>res<span class="ot">&lt;-</span><span class="fu">autoplot</span>(gating_applied[[<span class="dv">1</span>]])</span>
<span id="cb5-3"><a href="applying-gates-to-your-fcs-file-paths.html#cb5-3" tabindex="-1"></a>qcp <span class="ot">&lt;-</span> <span class="fu">ggcyto_arrange</span>(res, <span class="at">nrow =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="../../local_preparreddata/manualvsbatchcomp/gatingstrategy_WITHOUTveri.png" width="4000" /></p>
<p>And finally.. we are doing the loop for all files
Note that for here I am extracting the population statistics via
<code>gs_pop_get_count_with_meta()</code> for flowWorkspace, the argument <code>freq</code>
refers to freq against all the cells, and not just the direct parent population(unlike flowjo).
Therefore, i usually retrieve <code>count</code>instead and normalize against my parent of interest</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-1" tabindex="-1"></a>pop_stats_df_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-2"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-3" tabindex="-1"></a><span class="co">#replace with any title you want</span></span>
<span id="cb6-4"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-5" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&quot;all_gating_qc_plots_WITHOUTVERI.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">8</span>)</span>
<span id="cb6-6"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(gating_applied)) {</span>
<span id="cb6-8"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-8" tabindex="-1"></a>  </span>
<span id="cb6-9"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-9" tabindex="-1"></a>  gs <span class="ot">&lt;-</span> gating_applied[[i]]</span>
<span id="cb6-10"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-10" tabindex="-1"></a>  sample_name <span class="ot">&lt;-</span> <span class="fu">sampleNames</span>(gs)[<span class="dv">1</span>]</span>
<span id="cb6-11"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-11" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-12" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-13" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(gs)</span>
<span id="cb6-14"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-14" tabindex="-1"></a>  qcp <span class="ot">&lt;-</span> <span class="fu">ggcyto_arrange</span>(res, <span class="at">nrow =</span> <span class="dv">5</span>)</span>
<span id="cb6-15"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-15" tabindex="-1"></a>  </span>
<span id="cb6-16"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-16" tabindex="-1"></a>  <span class="fu">grid.newpage</span>()</span>
<span id="cb6-17"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-17" tabindex="-1"></a>  <span class="fu">grid.text</span>(sample_name, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.98</span>, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">16</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>))</span>
<span id="cb6-18"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-18" tabindex="-1"></a>  <span class="fu">pushViewport</span>(<span class="fu">viewport</span>(<span class="at">y =</span> <span class="fl">0.45</span>, <span class="at">height =</span> <span class="fl">0.9</span>))</span>
<span id="cb6-19"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-19" tabindex="-1"></a>  <span class="fu">grid.draw</span>(qcp)</span>
<span id="cb6-20"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-20" tabindex="-1"></a>  <span class="fu">popViewport</span>()</span>
<span id="cb6-21"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-21" tabindex="-1"></a>  </span>
<span id="cb6-22"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-22" tabindex="-1"></a>  pop_stats_i <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">gs_pop_get_count_with_meta</span>(gs, <span class="st">&quot;count&quot;</span>))</span>
<span id="cb6-23"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-23" tabindex="-1"></a>  pop_stats_df_list[[i]] <span class="ot">&lt;-</span> pop_stats_i</span>
<span id="cb6-24"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-24" tabindex="-1"></a>}</span>
<span id="cb6-25"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-26" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb6-27"><a href="applying-gates-to-your-fcs-file-paths.html#cb6-27" tabindex="-1"></a><span class="fu">names</span>(pop_stats_df_list)<span class="ot">&lt;-</span><span class="fu">sampleNames</span>(gating_applied)</span></code></pre></div>
<p>conversion to dataframe</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="applying-gates-to-your-fcs-file-paths.html#cb7-1" tabindex="-1"></a>pop_stats_df<span class="ot">&lt;-</span><span class="fu">imap_dfr</span>(pop_stats_df_list, <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">Sample =</span> .y))</span>
<span id="cb7-2"><a href="applying-gates-to-your-fcs-file-paths.html#cb7-2" tabindex="-1"></a><span class="fu">head</span>(pop_stats_df)</span></code></pre></div>
<p>Annd… thats it!
I think it really important to QC the output from the pdf where you can eyeball if there is any weird discrepancies from the batch gating.
Also to note, sometimes there may be sample to sample variation so if the gates doesnt work, we need to refine them from the wsp.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="importing-the-gating-template.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/3-Applying_gates.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
